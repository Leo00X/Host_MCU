HT32F52352  Keil5
# 基于物联网的多节点联动式智能新风系统 - 中央控制主机 (Host)

本项目是“基于物联网的多节点联动式家用智能新风系统”的中央控制主机（Master）部分。

中央控制主机是整个系统的指挥中心，采用高性能的`HT32F52367`单片机作为核心。它对内作为Zigbee网络协调器管理所有从机节点；对外通过`ESP8266` Wi-Fi模块连接`OneNET`云平台，承担物联网网关的职责；在本地，它驱动HMI触摸屏，实现对系统状态的全面监测与直接控制 。

## 系统架构

本系统采用“主从式”分布式网络架构。中央控制主机 (Master) 作为Zigbee网络协调器，负责管理三个（或多个）基于`STM32`的分布式新风从机 (Slaves) 。

## 核心功能

* **智能联动控制：** 实时整合所有分布式从机节点的环境数据，并结合主机本地的环境参数，依据预设的全局优化算法进行综合分析与决策，最终下发差异化的控制指令，协同调控各区域风扇转速。
* **物联网网关：** 通过`ESP8266` Wi-Fi模块接入互联网，运用`MQTT`协议将系统关键数据（如各区域环境参数、风机状态）实时上传至`ONENET`云平台 。
* **远程监控：** 支持使用`HBuilder X`开发的手机APP，实现对整个新风系统的远程实时监控和手动干预 。
* **本地HMI交互：** 驱动`淘晶驰T1系列3.5寸串口HMI触摸屏`，通过自主设计的UI界面，实现对全部节点（主机与各个从机）状态的全面监测与直接控制 。
* **中央环境监测：** 自身集成了`DHT11`、`MQ2`、`MQ7`、`PM2.5`等多种传感器，用于监测中央区域的环境状况，为主系统决策提供关键数据 。
* **Zigbee网络协调：** 作为Zigbee网络协调器，负责构建和管理与所有从机节点之间的低功耗、高可靠性的无线自组网 。

## 硬件规格 (Host)

| 组件 | 型号/规格 | 备注 |
| :--- | :--- | :--- |
| 核心MCU | `HT32F52367` (BM53A367A 开发板) | 系统主控 |
| Wi-Fi模块 | `ESP8266` | 连接OneNET云平台 |
| Zigbee模块 | `E18-MS1-PCB` (亿佰特CC2530) | 首选方案，用于与从机组网 |
| HMI触控屏 | 淘晶驰T1系列 3.5寸串口屏 (TJC4832T135011) | 本地人机交互界面 |
| 温湿度传感器 | `DHT11` | 监测主机区域环境 |
| 烟雾传感器 | `MQ2` | 监测主机区域环境 |
| 一氧化碳传感器 | `MQ7` | 监测主机区域环境 |
| PM2.5传感器 | `DC01` (红外) | 监测主机区域环境 |
| 蜂鸣器 | 有源蜂鸣器 | 报警提示 |
| 供电 | `Type-C` 供电 | |

## 软件功能实现

### 1. 无线通信
* **Zigbee组网：** 通过`E18-MS1-PCB`（首选）或`DL-20`（备选）Zigbee模块构建无线网络，实现主机与从机之间稳定可靠的数据交互。
* **自定义协议：** 采用自定义的通信协议进行节点间的数据交换。

### 2. 物联网 (IoT) 功能
* **云端连接：** 主机集成`ESP8266` Wi-Fi模块接入互联网。
* **MQTT通信：** 运用`MQTT`协议将系统关键数据（各区域环境参数、风机状态）实时上传至`ONENET`云平台。
* **APP远程控制：** 用户能够通过手机APP端（HBuilder X编写）远程查看系统实时状态，并可以手动下发控制指令。

### 3. HMI触控屏交互
* **串口通信：** 主机使用串口与HMI串口屏通信。
* **UI设计：** 自主设计UI界面，用于展示全部环境参数（主机、各个从机）、各个新风机运行状况。
* **本地控制：** 可通过触摸屏直接控制新风系统的运行模块。

### 4. 数据采集与处理
* **本地采集：** 通过`单线`、`ADC`、`UART`等方式，采集主机本地集成的各路环境传感器数据。
* **数据整合：** 接收所有从机节点的数据，进行统一分析并权衡。
* **决策下发：** 根据联动控制策略，自动下发指令决策各个新风机的运行状况与运行模式。
